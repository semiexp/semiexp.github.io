/*! @license pzpr.js vc7f167f6 (c) 2009-2021 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(a,b){"object"==typeof module&&module.exports?module.exports=[a,b]:pzpr.classmgr.makeCustom(a,b)}(["yajilin","yajilin-regions"],{MouseEvent:{RBShadeCell:!0,use:!0,mouseinput_auto:function(){if(this.puzzle.playmode){if(this.mousestart||this.mousemove){if("left"===this.btn)this.inputLine();else if("right"===this.btn){if(this.mousestart&&this.inputpeke_ifborder())return;this.firstCell.isnull&&!this.notInputted()||this.inputcell()}}else if(this.mouseend&&this.notInputted()){var a=this.getcell();if(!this.firstCell.isnull&&a!==this.firstCell)return;!a.isnull&&a.isNum()&&"yajilin"===this.pid?this.inputqcmp():this.inputcell()}}else this.puzzle.editmode&&(this.mousestart||this.mousemove?"yajilin"===this.pid?this.inputdirec():"yajilin-regions"===this.pid&&this.inputborder():this.mouseend&&this.notInputted()&&this.inputqnum())},inputqcmp:function(){var a=this.getcell();a.isnull||a.noNum()||(a.setQcmp(+!a.qcmp),a.draw(),this.mousereset())}},"MouseEvent@yajilin":{inputModes:{edit:["number","direc","clear","info-line"],play:["line","peke","shade","unshade","info-line","completion"]}},"MouseEvent@yajilin-regions":{inputModes:{edit:["number","border","clear","info-line"],play:["line","peke","shade","unshade","info-line"]}},KeyEvent:{enablemake:!0,moveTarget:function(a){return!a.match(/shift/)&&this.moveTCell(a)},keyinput:function(a){this.key_inputdirec(a)||this.key_inputqnum(a)}},Cell:{isDot:function(){return 0===this.lcnt&&1===this.qsub},countShade:function(a){return a?a.filter(function(a){return a.isShade()}).length:-1},countUndecided:function(a){return a?a.filter(function(a){return 0===a.qans&&!a.knowEmpty()}).length:-1},posthook:{qsub:function(){var a=[this];this.board.redrawAffected(a)},qans:function(){for(var a=[this],b=this.adjacent,c=[b.top,b.bottom,b.left,b.right],d=0;d<c.length;d++){var e=c[d];e.isnull||0!==e.qans||0!==e.qsub||a.push(e)}this.board.redrawAffected(a)},qnum:function(){this.setQsub(0),this.setQans(0);for(var a=this.adjborder,b=[a.top,a.bottom,a.left,a.right],c=0;c<b.length;c++)b[c].line=0}}},"Cell@yajilin":{minnum:0,maxnum:function(){return Math.max(this.board.cols+1>>1,this.board.rows+1>>1)},noLP:function(a){return this.isShade()||this.isNum()},allowShade:function(){return-1===this.qnum&&0===this.lcnt},allowUnshade:function(){return-1===this.qnum&&0===this.lcnt},knowEmpty:function(){return-1!==this.qnum||(0!==this.qsub||(this.lcnt>0||this.countDir4Cell(function(a){return a.isShade()>0})>0))},isCmp:function(){if(1===this.qcmp)return!0;if(!this.puzzle.execConfig("autocmp"))return!1;var a=this.getClist();return!!a&&(0===this.countUndecided(a)&&this.qnum===this.countShade(a))},getClist:function(){if(!this.isValidNum()||0===this.qdir)return null;for(var a=this.getaddr(),b=this.qdir,c=new this.klass.CellList;;){a.movedir(b,2);var d=a.getc();if(d.isnull)break;c.add(d)}return c}},"Cell@yajilin-regions":{minnum:0,maxnum:function(){return this.room.clist.length},noLP:function(a){return this.isShade()},allowShade:function(){return 0===this.lcnt},allowUnshade:function(){return 0===this.lcnt},knowEmpty:function(){return 0!==this.qsub||(this.lcnt>0||this.countDir4Cell(function(a){return a.isShade()>0})>0)},isCmp:function(){if(!this.puzzle.execConfig("autocmp"))return!1;var a=this.room.clist;return 0===this.countUndecided(a)&&this.qnum===this.countShade(a)}},Border:{enableLineNG:!0,posthook:{line:function(){for(var a=[],b=0;b<this.sidecell.length;b++)a.push(this.sidecell[b]);this.board.redrawAffected(a)}}},"Border@yajilin":{isBorder:function(){return-1===this.sidecell[0].qnum!=(-1===this.sidecell[1].qnum)}},Board:{hasborder:1,autoSolve:function(a){if(!this.is_autosolve&&!a){for(var b=!1,c=0;c<this.border.length;++c){var d=this.border[c];0===d.lineBySolver&&0===d.qsubBySolver||(b=!0,d.lineBySolver=0,d.qsubBySolver=0)}for(var c=0;c<this.cell.length;++c){var e=this.cell[c];0===e.qansBySolver&&0===e.qsubBySolver||(b=!0,e.qansBySolver=0,e.qsubBySolver=0)}return void(b&&this.puzzle.painter.paintAll())}for(var f=this.maxby/2,g=this.maxbx/2,h=[],i=0;i<f;++i){for(var j=[],k=0;k<g;++k)j.push(null);h.push(j)}var l=[-1,0,3,1,2];console.log(this.cell);for(var c=0;c<this.cell.length;++c)if(-1!==this.cell[c].qnum){var m=this.cell[c].qnum;h[(this.cell[c].by-1)/2][(this.cell[c].bx-1)/2]={direction:-2===m?-1:l[this.cell[c].qdir],value:m}}var n=Cspuz.puzzle.solveYajilin(f,g,h);if(null!==n){for(var c=0;c<this.border.length;++c){var o,d=this.border[c];o=d.by%2==1?n.horizontal[(d.by-1)/2][(d.bx-2)/2]:n.vertical[(d.by-2)/2][(d.bx-1)/2],0===o?(d.lineBySolver=0,d.qsubBySolver=0):1===o?(d.lineBySolver=1,d.qsubBySolver=0):2===o&&(d.lineBySolver=0,d.qsubBySolver=2)}for(var c=0;c<this.cell.length;++c){var e=this.cell[c],p=n.cell[(e.by-1)/2][(e.bx-1)/2];-1===p||e.qnum>=0?(e.qansBySolver=0,e.qsubBySolver=0):-2===p?(e.qansBySolver=1,e.qsubBySolver=0):-3===p&&(e.qansBySolver=0,e.qsubBySolver=1)}}else{for(var c=0;c<this.border.length;++c)this.border[c].lineBySolver=0,this.border[c].qsubBySolver=2;for(var c=0;c<this.cell.length;++c)this.cell[c].qansBySolver=0,this.cell[c].qsubBySolver=0}this.puzzle.painter.paintAll()}},"Board@yajilin":{redrawAffected:function(a){for(var b=this.maxbx,c=this.minbx,d=this.maxby,e=this.minby,f=0;f<a.length;f++){var g=a[f];b=Math.min(b,g.bx),c=Math.max(c,g.bx),d=Math.min(d,g.by),e=Math.max(e,g.by)}for(var h=b;h<=c;h+=2)for(var i=1;i<2*this.board.rows;i+=2){var g=this.board.getc(h,i);-1!==g.qnum&&g.draw()}for(var h=1;h<2*this.cols;h+=2)if(!(h>=b&&h<=c))for(var i=d;i<=e;i+=2){var g=this.board.getc(h,i);-1!==g.qnum&&g.draw()}}},"Board@yajilin-regions":{redrawAffected:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c].room.top;b[d.id]||(b[d.id]=!0,d.draw())}}},"BoardExec@yajilin":{adjustBoardData:function(a,b){this.adjustNumberArrow(a,b)}},"AreaRoomGraph@yajilin-regions":{enabled:!0,hastop:!0},LineGraph:{enabled:!0},Graphic:{qcmpcolor:"rgb(127,127,127)",autocmp:"number",irowake:!0,getQuesNumberColor:function(a){var b=this.getQuesNumberColor_mixed(a);return 1===(a.error||a.qinfo)?b:a.isCmp()?this.qcmpcolor:b},paint:function(){this.drawBGCells(),"yajilin-regions"===this.pid&&this.drawShadedCells(),this.drawDotCells(),this.drawGrid(),this.drawBorders(),"yajilin"===this.pid&&this.drawArrowNumbers(),this.drawLines(),"yajilin-regions"===this.pid&&this.drawQuesNumbers(),this.drawPekes(),this.drawChassis(),"yajilin-regions"===this.pid&&this.drawBoxBorders(!1),this.drawTarget()}},"Graphic@yajilin":{getBGCellColor:function(a){var b=a.error||a.qinfo;return 2===this.puzzle.getConfig("disptype_yajilin")&&-1!==a.qnum?"rgb(224,224,224)":1===a.qans||1===a.qansBySolver?1===b?this.errcolor1:1===a.qans&&1===a.qansBySolver?a.trial?this.solvertrialcolor:this.solverqanscolor:1===a.qansBySolver?this.solvercolor:a.trial?this.trialcolor:this.shadecolor:1===b?this.errbcolor1:null},getBorderColor:function(a){return 2===this.puzzle.getConfig("disptype_yajilin")&&a.isBorder()?this.quescolor:null}},"Graphic@yajilin-regions":{textoption:{ratio:.4,position:5,hoffset:.8,voffset:.75}},"Encode@yajilin":{decodePzpr:function(a){this.decodeArrowNumber16(),this.puzzle.setConfig("disptype_yajilin",this.checkpflag("b")?2:1)},encodePzpr:function(a){this.encodeArrowNumber16(),this.outpflag=2===this.puzzle.getConfig("disptype_yajilin")?"b":null},decodeKanpen:function(){this.fio.decodeCellDirecQnum_kanpen(!0)},encodeKanpen:function(){this.fio.encodeCellDirecQnum_kanpen(!0)}},"Encode@yajilin-regions":{decodePzpr:function(a){this.decodeBorder(),this.decodeRoomNumber16()},encodePzpr:function(a){this.encodeBorder(),this.encodeRoomNumber16()}},"FileIO@yajilin":{decodeData:function(){this.decodeCellDirecQnum(),this.decodeCellAns(),this.decodeBorderLine()},encodeData:function(){this.encodeCellDirecQnum(),this.encodeCellAns(),this.encodeBorderLine()},kanpenOpen:function(){this.decodeCellDirecQnum_kanpen(!1),this.decodeBorderLine()},kanpenSave:function(){this.encodeCellDirecQnum_kanpen(!1),this.encodeBorderLine()},decodeCellDirecQnum_kanpen:function(a){this.decodeCell(function(b,c){if("#"!==c||a)if("+"!==c||a){if("-4"===c)b.qnum=-2;else if("."!==c){var d=+c,e=(48&d)>>4;0===e?b.qdir=b.UP:1===e?b.qdir=b.LT:2===e?b.qdir=b.DN:3===e&&(b.qdir=b.RT),b.qnum=15&d}}else b.qsub=1;else b.qans=1})},encodeCellDirecQnum_kanpen:function(a){this.encodeCell(function(b){var c,d=b.qnum>=0&&b.qnum<16?b.qnum:-1;if(-1!==d&&b.qdir!==b.NDIR)return b.qdir===b.UP?c=0:b.qdir===b.LT?c=1:b.qdir===b.DN?c=2:b.qdir===b.RT&&(c=3),(c<<4)+(15&d)+" ";if(-2===b.qnum)return"-4 ";if(!a){if(1===b.qans)return"# ";if(1===b.qsub)return"+ "}return". "})},kanpenOpenXML:function(){this.decodeCellDirecQnum_XMLBoard(),this.decodeBorderLine_XMLAnswer()},kanpenSaveXML:function(){this.encodeCellDirecQnum_XMLBoard(),this.encodeBorderLine_XMLAnswer()},decodeCellDirecQnum_XMLBoard:function(){this.decodeCellXMLBoard(function(a,b){if(b>=0){var c=(48&b)>>4;0===c?a.qdir=a.UP:1===c?a.qdir=a.LT:2===c?a.qdir=a.DN:3===c&&(a.qdir=a.RT),a.qnum=15&b}else-1===b?a.qsub=1:-2===b?a.qans=1:-4===b&&(a.qnum=-2)})},encodeCellDirecQnum_XMLBoard:function(){this.encodeCellXMLBoard(function(a){var b=-3,c=0;return-1!==a.qnum&&a.qdir!==a.NDIR?(a.qdir===a.UP?c=0:a.qdir===a.LT?c=1:a.qdir===a.DN?c=2:a.qdir===a.RT&&(c=3),b=(c<<4)+(15&a.qnum)):-2===a.qnum?b=-4:1===a.qans?b=-2:1===a.qsub&&(b=-1),b})}},"FileIO@yajilin-regions":{decodeData:function(){this.decodeAreaRoom(),this.decodeCellQnum(),this.decodeCellAns(),this.decodeBorderLine()},encodeData:function(){this.encodeAreaRoom(),this.encodeCellQnum(),this.encodeCellAns(),this.encodeBorderLine()}},AnsCheck:{checklist:["checkBranchLine","checkCrossLine","checkLineOnShadeCell","checkAdjacentShadeCell","checkDeadendLine+","checkArrowNumber@yajilin","checkShadeCellCount@yajilin-regions","checkOneLoop","checkEmptyCell_yajilin+@yajilin","checkEmptyCell_regions+@yajilin-regions","checkNumberHasArrow@yajilin"],checkEmptyCell_yajilin:function(){this.checkAllCell(function(a){return 0===a.lcnt&&!a.isShade()&&a.noNum()},"ceEmpty")},checkEmptyCell_regions:function(){this.checkAllCell(function(a){return 0===a.lcnt&&!a.isShade()},"ceEmpty")},checkArrowNumber:function(){for(var a=this.board,b=0;b<a.cell.length;b++){var c=a.cell[b],d=c.getClist(),e=c.countShade(d);if(!(e<0||c.qnum===e)){if(this.failcode.add("anShadeNe"),this.checkOnly)break;c.seterr(1),d.seterr(1)}}}},FailCode:{ceEmpty:["黒マスも線も引かれていないマスがあります。","There is an empty cell."]}});